<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒ«ãƒãƒ«ãƒãƒ³ 3æšå¼•ãï¼ˆéå»ãƒ»ç¾åœ¨ãƒ»æœªæ¥ï¼‰+ ã‚¢ãƒ‰ãƒã‚¤ã‚¹</title>
  <style>
    :root{
      --cream:#fbf4e6;
      --cream2:#fff8ee;
      --ink:#3a2f2a;
      --accent:#d8a85b;
      --accent2:#caa3ff;
      --shadow: 0 18px 40px rgba(58,47,42,.12);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(202,163,255,.18), transparent 55%),
        radial-gradient(900px 520px at 85% 25%, rgba(216,168,91,.18), transparent 60%),
        linear-gradient(180deg, var(--cream2), var(--cream));
      min-height:100svh;
      overflow-x:hidden;
    }

    /* ãã‚‰ãã‚‰èƒŒæ™¯ï¼ˆè»½ã‚ï¼‰ */
    .sparkles{
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(2px 2px at 12% 22%, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(2px 2px at 58% 18%, rgba(255,255,255,.75), transparent 60%),
        radial-gradient(1.6px 1.6px at 78% 42%, rgba(255,255,255,.85), transparent 60%),
        radial-gradient(2.2px 2.2px at 32% 68%, rgba(255,255,255,.8), transparent 60%),
        radial-gradient(1.8px 1.8px at 88% 76%, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(1.4px 1.4px at 18% 82%, rgba(255,255,255,.8), transparent 60%);
      opacity:.85;
      filter: blur(.2px);
      animation: twinkle 6.5s ease-in-out infinite;
    }
    @keyframes twinkle{
      0%,100%{opacity:.65; transform: translateY(0)}
      50%{opacity:.95; transform: translateY(-6px)}
    }

    header{
      padding: 26px 16px 10px;
      text-align:center;
    }
    .title{
      font-weight: 800;
      letter-spacing:.04em;
      font-size: clamp(20px, 4vw, 34px);
      margin:0 0 6px;
    }
    .subtitle{
      margin:0;
      opacity:.85;
      font-size: 14px;
    }

    .wrap{
      width:min(1060px, 92vw);
      margin: 14px auto 40px;
    }

    .panel{
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(58,47,42,.08);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 18px;
      backdrop-filter: blur(6px);
    }

    .row{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 900px){
      .row{grid-template-columns:1fr; }
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }

    .seg{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

    .chip{
      border-radius: 999px;
      padding: 10px 14px;
      border: 1px solid rgba(58,47,42,.12);
      background: rgba(255,255,255,.7);
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      user-select:none;
      font-weight:700;
      font-size: 14px;
    }
    .chip:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(58,47,42,.10); }
    .chip.active{
      background: linear-gradient(180deg, rgba(216,168,91,.26), rgba(202,163,255,.18));
      border-color: rgba(216,168,91,.55);
    }

    .btn{
      border:0;
      border-radius: 14px;
      padding: 12px 16px;
      font-weight: 800;
      cursor:pointer;
      color: #2b221e;
      background: linear-gradient(180deg, rgba(216,168,91,.75), rgba(216,168,91,.45));
      box-shadow: 0 12px 26px rgba(216,168,91,.25);
      transition: transform .12s ease, filter .12s ease;
      letter-spacing:.02em;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.02); }
    .btn:disabled{
      opacity:.6; cursor:not-allowed; transform:none;
    }

    .hint{
      margin: 10px 0 0;
      font-size: 13px;
      opacity: .85;
      line-height: 1.6;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 900px){
      .cards{ grid-template-columns:1fr; }
    }

    .cardSlot{
      border-radius: 20px;
      padding: 12px;
      border: 1px dashed rgba(58,47,42,.18);
      background: rgba(255,255,255,.45);
      position:relative;
      overflow:hidden;
    }
    .slotTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .tag{
      font-weight: 900;
      font-size: 13px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(202,163,255,.18);
      border: 1px solid rgba(202,163,255,.35);
    }
    .step{
      font-size: 12px;
      opacity:.75;
      font-weight:700;
    }

    /* ãƒ•ãƒªãƒƒãƒ— */
    .flip{
      width:100%;
      aspect-ratio: 3 / 4.2;
      perspective: 1200px;
      border-radius: 18px;
      overflow:hidden;
      position:relative;
    }
    .flipInner{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      transition: transform .75s cubic-bezier(.2,.8,.2,1);
    }
    .flip.revealed .flipInner{ transform: rotateY(180deg); }

    .face{
      position:absolute; inset:0;
      backface-visibility:hidden;
      border-radius: 18px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      border: 1px solid rgba(58,47,42,.12);
      box-shadow: 0 14px 30px rgba(58,47,42,.10);
      background: rgba(255,255,255,.7);
    }
    .back{
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(202,163,255,.25), transparent 60%),
        radial-gradient(900px 500px at 80% 90%, rgba(216,168,91,.28), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55));
    }
    .back::after{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(2px 2px at 12% 22%, rgba(255,255,255,.95), transparent 60%),
        radial-gradient(2px 2px at 58% 18%, rgba(255,255,255,.75), transparent 60%),
        radial-gradient(1.6px 1.6px at 78% 42%, rgba(255,255,255,.85), transparent 60%),
        radial-gradient(2.2px 2.2px at 32% 68%, rgba(255,255,255,.8), transparent 60%),
        radial-gradient(1.8px 1.8px at 88% 76%, rgba(255,255,255,.7), transparent 60%);
      opacity:.9;
      animation: twinkle 5.8s ease-in-out infinite;
      filter: blur(.1px);
    }
    .backMark{
      position:relative;
      text-align:center;
      padding: 14px;
    }
    .backMark .logo{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      letter-spacing:.06em;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(58,47,42,.12);
      background: rgba(255,255,255,.55);
    }
    .backMark small{ display:block; margin-top:10px; opacity:.8; font-weight:700; }

    .front{
      transform: rotateY(180deg);
      background: rgba(255,255,255,.85);
    }

    .cardImg{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .revealBtn{
      margin-top: 10px;
      width:100%;
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(58,47,42,.12);
      background: rgba(255,255,255,.72);
      cursor:pointer;
      font-weight:800;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .revealBtn:hover{ transform: translateY(-1px); box-shadow: 0 10px 18px rgba(58,47,42,.10); }
    .revealBtn:disabled{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }

    .desc{
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.85;
      white-space: pre-wrap;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(58,47,42,.08);
      border-radius: 16px;
      padding: 12px 12px;
      min-height: 96px;
    }

    .storyBox{
      padding: 14px;
    }
    .storyTitle{
      font-weight: 900;
      margin: 0 0 8px;
      font-size: 16px;
      letter-spacing:.02em;
    }
    .storyText{
      margin:0;
      line-height:1.9;
      font-size: 14px;
      white-space: pre-wrap;
    }

    .adviceArea{
      margin-top: 14px;
      display:none;
    }
    .adviceArea.show{ display:block; }

    .hr{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(58,47,42,.14), transparent);
      margin: 12px 0;
    }

    .toast{
      margin-top: 10px;
      font-size: 12px;
      opacity:.78;
    }
  </style>
</head>
<body>
  <div class="sparkles" aria-hidden="true"></div>

  <header>
    <h1 class="title">ãƒ«ãƒãƒ«ãƒãƒ³ã‚«ãƒ¼ãƒ‰ 3æšå¼•ã</h1>
    <p class="subtitle">ã€Œéå» â†’ ç¾åœ¨ â†’ æœªæ¥ã€ï¼‹ æœ€å¾Œã«ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚«ãƒ¼ãƒ‰</p>
  </header>

  <div class="wrap">
    <div class="panel row">
      <section>
        <div class="controls">
          <div class="seg" role="group" aria-label="å ã„ãƒ†ãƒ¼ãƒ">
            <button class="chip active" data-mode="love">æ‹æ„›</button>
            <button class="chip" data-mode="work">ä»•äº‹</button>
            <button class="chip" data-mode="overall">å…¨ä½“é‹</button>
          </div>
          <div class="seg">
            <button id="startBtn" class="btn">ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å ã†</button>
            <button id="resetBtn" class="btn" style="background:linear-gradient(180deg, rgba(202,163,255,.65), rgba(202,163,255,.35)); box-shadow:0 12px 26px rgba(202,163,255,.22);">
              ãƒªã‚»ãƒƒãƒˆ
            </button>
          </div>
        </div>

        <p class="hint">
          â‘  ãƒ†ãƒ¼ãƒã‚’é¸ã¶ â†’ â‘¡ã€Œã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦å ã†ã€ â†’ â‘¢ã€Œã‚«ãƒ¼ãƒ‰ã‚’é–‹ãã€ã‚’ <b>éå»â†’ç¾åœ¨â†’æœªæ¥</b> ã®é †ã«æŠ¼ã—ã¦ãã ã•ã„ã€‚<br/>
          æœ€å¾Œã« <b>ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚«ãƒ¼ãƒ‰</b> ãŒè¿½åŠ ã§é–‹ãã¾ã™ã€‚
        </p>

        <div class="cards">
          <!-- Past -->
          <div class="cardSlot" id="slot0">
            <div class="slotTop">
              <span class="tag">éå»</span>
              <span class="step" id="step0">Step 1</span>
            </div>

            <div class="flip" id="flip0" aria-label="éå»ã®ã‚«ãƒ¼ãƒ‰">
              <div class="flipInner">
                <div class="face back">
                  <div class="backMark">
                    <div class="logo">âœ¦ Lenormand âœ¦</div>
                    <small>ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã„ã¦ãã ã•ã„</small>
                  </div>
                </div>
                <div class="face front">
                  <img class="cardImg" id="img0" alt="éå»ã®ã‚«ãƒ¼ãƒ‰ç”»åƒ" />
                </div>
              </div>
            </div>
            <button class="revealBtn" id="reveal0" disabled>ã‚«ãƒ¼ãƒ‰ã‚’é–‹ãï¼ˆéå»ï¼‰</button>
            <div class="desc" id="desc0">ã¾ã ã‚«ãƒ¼ãƒ‰ã¯å¼•ã‹ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>
          </div>

          <!-- Present -->
          <div class="cardSlot" id="slot1">
            <div class="slotTop">
              <span class="tag">ç¾åœ¨</span>
              <span class="step" id="step1">Step 2</span>
            </div>

            <div class="flip" id="flip1" aria-label="ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰">
              <div class="flipInner">
                <div class="face back">
                  <div class="backMark">
                    <div class="logo">âœ¦ Lenormand âœ¦</div>
                    <small>æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã¯ã¾ã çœ ã£ã¦ã„ã¾ã™</small>
                  </div>
                </div>
                <div class="face front">
                  <img class="cardImg" id="img1" alt="ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ç”»åƒ" />
                </div>
              </div>
            </div>
            <button class="revealBtn" id="reveal1" disabled>ã‚«ãƒ¼ãƒ‰ã‚’é–‹ãï¼ˆç¾åœ¨ï¼‰</button>
            <div class="desc" id="desc1">éå»ã®ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã„ãŸã‚‰ã€æ¬¡ãŒé–‹ã‘ã¾ã™ã€‚</div>
          </div>

          <!-- Future -->
          <div class="cardSlot" id="slot2">
            <div class="slotTop">
              <span class="tag">æœªæ¥</span>
              <span class="step" id="step2">Step 3</span>
            </div>

            <div class="flip" id="flip2" aria-label="æœªæ¥ã®ã‚«ãƒ¼ãƒ‰">
              <div class="flipInner">
                <div class="face back">
                  <div class="backMark">
                    <div class="logo">âœ¦ Lenormand âœ¦</div>
                    <small>æœªæ¥ã¯ã‚†ã£ãã‚Šé–‹ãã¾ã—ã‚‡ã†</small>
                  </div>
                </div>
                <div class="face front">
                  <img class="cardImg" id="img2" alt="æœªæ¥ã®ã‚«ãƒ¼ãƒ‰ç”»åƒ" />
                </div>
              </div>
            </div>
            <button class="revealBtn" id="reveal2" disabled>ã‚«ãƒ¼ãƒ‰ã‚’é–‹ãï¼ˆæœªæ¥ï¼‰</button>
            <div class="desc" id="desc2">ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã„ãŸã‚‰ã€æ¬¡ãŒé–‹ã‘ã¾ã™ã€‚</div>
          </div>
        </div>

        <div class="adviceArea" id="adviceArea">
          <div class="hr"></div>
          <div class="cards" style="grid-template-columns:1fr; gap:12px;">
            <div class="cardSlot">
              <div class="slotTop">
                <span class="tag" style="background: rgba(216,168,91,.18); border-color: rgba(216,168,91,.35);">ã‚¢ãƒ‰ãƒã‚¤ã‚¹</span>
                <span class="step">Bonus</span>
              </div>

              <div class="flip" id="flipA" aria-label="ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚«ãƒ¼ãƒ‰">
                <div class="flipInner">
                  <div class="face back">
                    <div class="backMark">
                      <div class="logo">âœ¦ Advice âœ¦</div>
                      <small>æœ€å¾Œã«ã€èƒŒä¸­ã‚’æŠ¼ã™1æš</small>
                    </div>
                  </div>
                  <div class="face front">
                    <img class="cardImg" id="imgA" alt="ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚«ãƒ¼ãƒ‰ç”»åƒ" />
                  </div>
                </div>
              </div>

              <button class="revealBtn" id="revealA" disabled>ã‚«ãƒ¼ãƒ‰ã‚’é–‹ãï¼ˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼‰</button>
              <div class="desc" id="descA">3æšã®çµæœãŒå‡ºãŸã‚‰ã€æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ãŒå¼•ã‘ã¾ã™ã€‚</div>
            </div>
          </div>

          <div class="panel storyBox" style="margin-top:12px;">
            <h3 class="storyTitle">ã¾ã¨ã‚ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h3>
            <p class="storyText" id="summaryText">ã“ã“ã«ã€3æšï¼‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã¤ãªã„ã ç‰©èªã¨åŠ©è¨€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
            <div class="toast" id="seedInfo"></div>
          </div>
        </div>
      </section>

      <aside class="panel storyBox" style="background: rgba(255,255,255,.62);">
        <h3 class="storyTitle">ã“ã®å ã„ã®è¦‹æ–¹</h3>
        <p class="storyText">
éå»ï¼šã„ã¾ã«ç¶šãã€Œãã£ã‹ã‘ã€ã‚„ã€å¿ƒã®ç™–ãƒ»èƒŒæ™¯
ç¾åœ¨ï¼šã„ã¾èµ·ãã¦ã„ã‚‹ã€ŒçŠ¶æ³ã€ã‚„ã€ç›®ã®å‰ã®ãƒ†ãƒ¼ãƒ
æœªæ¥ï¼šã“ã®æµã‚ŒãŒå‘ã‹ã†ã€Œå±•é–‹ã€ã‚„ã€å–ã‚Šã‚„ã™ã„é¸æŠ

æœ€å¾Œã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š3æšã‚’è¸ã¾ãˆãŸã€Œæœ€çŸ­ã§æ•´ã†ä¸€æ‰‹ã€

â€»ãƒ«ãƒãƒ«ãƒãƒ³ã¯ â€œå‡ºæ¥äº‹â€ ã®æå†™ãŒå¾—æ„ãªã®ã§ã€
ã‚«ãƒ¼ãƒ‰åŒå£«ã‚’ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ã¤ãªã„ã§èª­ã‚€ã¨ã€ç¾å®Ÿçš„ã«æ´»ã‹ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚
        </p>
        <div class="hr"></div>
        <p class="storyText" style="opacity:.85; font-size:13px;">
ãƒ†ãƒ¼ãƒï¼ˆæ‹æ„›/ä»•äº‹/å…¨ä½“é‹ï¼‰ã«åˆã‚ã›ã¦ã€èª¬æ˜æ–‡ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚
        </p>
      </aside>
    </div>
  </div>

  <script>
    // =========================
    // ãƒ«ãƒãƒ«ãƒãƒ³ 36æšï¼šåå‰ + ã‚·ãƒ³ãƒœãƒ« + æ„å‘³ï¼ˆãƒ†ãƒ¼ãƒåˆ¥ï¼‰
    // â€»æ–‡ç« ã¯ã‚¢ãƒ—ãƒªç”¨ã«çŸ­ã‚ï¼†ã‚¹ãƒˆãƒ¼ãƒªãƒ¼èª¿ã«ç”Ÿæˆ
    // =========================
    const DECK = [
      { id:1,  name:"é¨å£«", icon:"ğŸ", meanings:{
        love:"é€£çµ¡ãƒ»é€²å±•ã€‚ä¼šã„ãŸã„æ°—æŒã¡ãŒèµ°ã‚Šå‡ºã™ã€‚",
        work:"ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã€‚æ–°æ¡ˆä»¶ã‚„ä¾é ¼ãŒèˆã„è¾¼ã‚€ã€‚",
        overall:"æµã‚ŒãŒå‹•ãã€‚å°ã•ãªä¸€æ­©ãŒè¿½ã„é¢¨ã«ã€‚"
      }},
      { id:2,  name:"ã‚¯ãƒ­ãƒ¼ãƒãƒ¼", icon:"ğŸ€", meanings:{
        love:"å°ã•ãªå¹¸é‹ã€‚è‚©ã®åŠ›ãŒæŠœã‘ã¦è·é›¢ãŒç¸®ã‚€ã€‚",
        work:"ãƒãƒ£ãƒ³ã‚¹ã¯çŸ­æœŸã€‚è»½ãè©¦ã™ã¨å½“ãŸã‚Šã‚„ã™ã„ã€‚",
        overall:"ãƒ©ãƒƒã‚­ãƒ¼ã¯â€œã•ã‚Šã’ãªãâ€ã€‚æ‹¾ã£ãŸäººãŒå¾—ã‚’ã™ã‚‹ã€‚"
      }},
      { id:3,  name:"èˆ¹", icon:"â›µ", meanings:{
        love:"è·é›¢ãƒ»æ—…ãƒ»ä¾¡å€¤è¦³ã®åºƒãŒã‚Šã€‚é ãã®ç¸ã€‚",
        work:"å–å¼•ãƒ»ç§»å‹•ãƒ»æ‹¡å¤§ã€‚è¦–é‡ã‚’åºƒã’ã‚‹ã»ã©å®Ÿã‚‹ã€‚",
        overall:"æ–°ã—ã„æµ·ã¸ã€‚æœªçŸ¥ã‚’é¸ã¶ã»ã©é‹ãŒä¼¸ã³ã‚‹ã€‚"
      }},
      { id:4,  name:"å®¶", icon:"ğŸ ", meanings:{
        love:"å®‰å¿ƒã¨å±…å ´æ‰€ã€‚ç´ ç›´ã•ãŒé–¢ä¿‚ã‚’è‚²ã¦ã‚‹ã€‚",
        work:"åŸºç›¤ã¥ãã‚Šã€‚ä»•çµ„ã¿åŒ–ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãŒéµã€‚",
        overall:"æš®ã‚‰ã—ã‚’æ•´ãˆã‚‹ã¨å…¨ä½“ãŒæ•´ã†ã€‚"
      }},
      { id:5,  name:"æœ¨", icon:"ğŸŒ³", meanings:{
        love:"ã‚†ã£ãã‚Šæ·±ã¾ã‚‹ã€‚ç™’ã—ã¨ä¿¡é ¼ã®ç©ã¿é‡ã­ã€‚",
        work:"é•·æœŸæˆ¦ã€‚ä½“åŠ›ãƒ»å¥åº·ç®¡ç†ãŒæˆæœã«ç›´çµã€‚",
        overall:"æ ¹ã‚’å¼µã‚‹æ™‚æœŸã€‚ç¶™ç¶šãŒã„ã¡ã°ã‚“ã®é–‹é‹ã€‚"
      }},
      { id:6,  name:"é›²", icon:"â˜ï¸", meanings:{
        love:"ã‚‚ã‚„ã‚‚ã‚„ãƒ»èª¤è§£ã€‚è¨€è‘‰ã®è£œè¶³ã§æ™´ã‚Œã‚‹ã€‚",
        work:"ä¸é€æ˜ã€‚æƒ…å ±ä¸è¶³ãªã‚‰â€œç¢ºèªâ€ãŒçªç ´å£ã€‚",
        overall:"è¦‹ãˆãªã„ã ã‘ã€‚æ€¥ãŒãšå¤©æ°—å¾…ã¡ãŒå‰ã€‚"
      }},
      { id:7,  name:"è›‡", icon:"ğŸ", meanings:{
        love:"å«‰å¦¬ãƒ»é§†ã‘å¼•ãã€‚æ­£ç›´ã•ãŒæœ€å¼·ã®è§£æ¯’ã€‚",
        work:"è¤‡é›‘ãƒ»å›ã‚Šé“ã€‚è£ã‚’èª­ã‚€ã‚ˆã‚Šæ•´ç†ãŒåŠ¹ãã€‚",
        overall:"ã­ã˜ã‚Œã¯è§£ã‘ã‚‹ã€‚ç„¦ã‚‰ãšä¸€æœ¬ãšã¤ã»ã©ãã€‚"
      }},
      { id:8,  name:"æ£º", icon:"âš°ï¸", meanings:{
        love:"çµ‚ã‚ã‚Šã¨å†å‡ºç™ºã€‚å¤ã„æƒ³ã„ã‚’æ‰‹æ”¾ã™åˆå›³ã€‚",
        work:"åŒºåˆ‡ã‚Šã€‚å½¹å‰²å¤‰æ›´ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¹•å¼•ãã€‚",
        overall:"ãƒªã‚»ãƒƒãƒˆã®åŠ›ã€‚ç©ºç™½ãŒæ¬¡ã®å¹¸é‹ã‚’å‘¼ã¶ã€‚"
      }},
      { id:9,  name:"èŠ±æŸ", icon:"ğŸ’", meanings:{
        love:"å¥½æ„ãƒ»ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã€‚ç´ ç›´ãªå–œã³ãŒæ‹ã‚’å’²ã‹ã›ã‚‹ã€‚",
        work:"è©•ä¾¡ãƒ»ç§°è³›ã€‚ä¸å¯§ã•ãŒç›®ã«ç•™ã¾ã‚‹ã€‚",
        overall:"ç¥ç¦ãƒ ãƒ¼ãƒ‰ã€‚ã‚ã‚ŠãŒã¨ã†ãŒé‹ã‚’å¢—å¹…ã€‚"
      }},
      { id:10, name:"éŒ", icon:"ğŸŒ¾", meanings:{
        love:"æ±ºæ–­ãƒ»åˆ‡ã‚Šæ›¿ãˆã€‚è¿·ã„ã‚’æ–­ã¤ã¨è»½ããªã‚‹ã€‚",
        work:"ç· åˆ‡ãƒ»å³æ–­ã€‚ã‚¹ãƒ‘ãƒƒã¨ã‚„ã‚‹ã»ã©è©•ä¾¡ã€‚",
        overall:"ã‚¿ã‚¤ãƒŸãƒ³ã‚°å‹è² ã€‚å…ˆå»¶ã°ã—ã‚’åˆˆã‚Šå–ã‚‹ã€‚"
      }},
      { id:11, name:"é­", icon:"âš¡", meanings:{
        love:"å£è«–ãƒ»åˆºæ¿€ã€‚ç†±ã¯ã‚ã‚‹ã€æ‰±ã„æ–¹æ¬¡ç¬¬ã€‚",
        work:"ä¿®æ­£ãƒ»åå¾©ã€‚é›ãˆã‚‹ã»ã©å¼·ããªã‚‹ãƒ†ãƒ¼ãƒã€‚",
        overall:"æºã•ã¶ã‚Šã§ç›®ãŒè¦šã‚ã‚‹ã€‚ç¿’æ…£ã‚’è¦‹ç›´ã™æ™‚ã€‚"
      }},
      { id:12, name:"é³¥", icon:"ğŸ¦", meanings:{
        love:"ä¼šè©±ãƒ»å™‚ã€‚è»½ã„é€£çµ¡ãŒæœªæ¥ã‚’ã¤ãã‚‹ã€‚",
        work:"æ‰“åˆã›ãƒ»é€£çµ¡ç¶²ã€‚å°åˆ»ã¿ã«å…±æœ‰ãŒå‰ã€‚",
        overall:"æƒ…å ±ãŒé£›ã³äº¤ã†ã€‚èãåŠ›ãŒé–‹é‹ã€‚"
      }},
      { id:13, name:"å­ã©ã‚‚", icon:"ğŸ§¸", meanings:{
        love:"ã¯ã˜ã¾ã‚Šãƒ»ãƒ”ãƒ¥ã‚¢ã€‚ç…§ã‚Œã‚’è¶Šãˆã‚‹ã¨é€²ã‚€ã€‚",
        work:"æ–°ä¼ç”»ãƒ»æ–°äººã€‚å­¦ã³ç›´ã—ãŒæ­¦å™¨ã«ãªã‚‹ã€‚",
        overall:"æ–°é®®ã•ã€‚å°ã•ãå§‹ã‚ã‚‹ã»ã©ç¶šãã€‚"
      }},
      { id:14, name:"ç‹", icon:"ğŸ¦Š", meanings:{
        love:"æ…é‡ã•ã€‚ç›¸æ‰‹ã‚’è¦‹ã‚‹ç›®ã‚’æŸ”ã‚‰ã‹ãé‹­ãã€‚",
        work:"è¦é ˜ãƒ»æˆ¦ç•¥ã€‚åŠ¹ç‡åŒ–ã§å‹ã¡ã«è¡Œãã€‚",
        overall:"è³¢ãå®ˆã‚‹é‹ã€‚ç„¡ç†ã‚’ã—ãªã„é¸æŠãŒæ­£è§£ã€‚"
      }},
      { id:15, name:"ç†Š", icon:"ğŸ»", meanings:{
        love:"å®ˆã‚ŠãŸã„æ°—æŒã¡ã€‚ç‹¬å æ¬²ã¯â€œå®‰å¿ƒâ€ã«å¤‰æ›ã—ã¦ã€‚",
        work:"å½±éŸ¿åŠ›ãƒ»è³‡é‡‘ã€‚å¼·æ°—ã§ã¾ã¨ã‚ã‚‹åŠ›ã€‚",
        overall:"é ¼ã‚Œã‚‹åŠ›ãŒæ¥ã‚‹ã€‚è‡ªåˆ†ã®å™¨ã‚’å¤§ããã€‚"
      }},
      { id:16, name:"æ˜Ÿ", icon:"â­", meanings:{
        love:"å¸Œæœ›ãƒ»ç†æƒ³ã€‚é¡˜ã„ã‚’è¨€è‘‰ã«ã™ã‚‹ã¨å¶ã„ã‚„ã™ã„ã€‚",
        work:"ç›®æ¨™è¨­å®šã€‚æ•°å€¤åŒ–ã™ã‚‹ã¨é“ãŒé–‹ãã€‚",
        overall:"å°ãã®å…‰ã€‚è¿·ã£ã¦ã‚‚â€œåŒ—æ¥µæ˜Ÿâ€ã¯ã‚ã‚‹ã€‚"
      }},
      { id:17, name:"ã‚³ã‚¦ãƒãƒˆãƒª", icon:"ğŸ•Šï¸", meanings:{
        love:"å¤‰åŒ–ãƒ»é€²å±•ã€‚é–¢ä¿‚ãŒæ¬¡ã®æ®µéšã¸ã€‚",
        work:"ç•°å‹•ãƒ»åˆ·æ–°ã€‚ç’°å¢ƒãŒå‹•ã„ã¦è¿½ã„é¢¨ã«ã€‚",
        overall:"æµã‚ŒãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã€‚è»½ã‚„ã‹ã«ä¹—ã‚‹ã¨å‰ã€‚"
      }},
      { id:18, name:"çŠ¬", icon:"ğŸ¶", meanings:{
        love:"ä¿¡é ¼ãƒ»å‘³æ–¹ã€‚å‹æƒ…ãŒæ‹ã«è‚²ã¤ã“ã¨ã‚‚ã€‚",
        work:"å”åŠ›è€…ã€‚ãƒãƒ¼ãƒ ã§æˆæœãŒå‡ºã‚‹ã€‚",
        overall:"æ”¯ãˆåˆã„ã€‚åŠ©ã‘ã‚’æ±‚ã‚ã‚‹ã»ã©é‹ãŒå›ã‚‹ã€‚"
      }},
      { id:19, name:"å¡”", icon:"ğŸ—¼", meanings:{
        love:"è·é›¢æ„Ÿãƒ»è‡ªç«‹ã€‚è¿‘ã¥ãå‰ã«å¢ƒç•Œç·šã‚’æ•´ãˆã‚‹ã€‚",
        work:"çµ„ç¹”ãƒ»å…¬çš„ã€‚ãƒ«ãƒ¼ãƒ«é †å®ˆãŒæœ€çŸ­ãƒ«ãƒ¼ãƒˆã€‚",
        overall:"é«˜ã„è¦–ç‚¹ã€‚å­¤ç‹¬ã¯â€œæ•´ãˆã‚‹æ™‚é–“â€ã«ãªã‚‹ã€‚"
      }},
      { id:20, name:"åº­", icon:"ğŸ›ï¸", meanings:{
        love:"å‡ºä¼šã„ã®å ´ã€‚äººã®é›†ã¾ã‚‹æ‰€ã«ç¸ãŒã‚ã‚‹ã€‚",
        work:"ç¤¾äº¤ãƒ»ç™ºä¿¡ã€‚è¦‹ã›æ–¹ã§è©•ä¾¡ãŒå¤‰ã‚ã‚‹ã€‚",
        overall:"å¤–ã«é–‹ãé‹ã€‚äº¤æµãŒå¹¸é‹ã®å…¥å£ã€‚"
      }},
      { id:21, name:"å±±", icon:"â›°ï¸", meanings:{
        love:"éšœå®³ãƒ»å£ã€‚ç„¦ã‚‰ãšè¶Šãˆã‚‹æ®µå–ã‚Šã‚’ã€‚",
        work:"é›£é–¢ã€‚æ­£æ”»æ³•ã§ç©ã‚€ã¨çªç ´ã§ãã‚‹ã€‚",
        overall:"è©¦ç·´ã¯â€œåŠ›ã‚’å¢—ã‚„ã™å‚é“â€ã€‚"
      }},
      { id:22, name:"é“", icon:"ğŸ›¤ï¸", meanings:{
        love:"é¸æŠã€‚ã©ã¡ã‚‰ã‚’é¸ã‚“ã§ã‚‚â€œè¦šæ‚Ÿâ€ãŒéµã€‚",
        work:"åˆ†å²ç‚¹ã€‚å„ªå…ˆé †ä½ã‚’æ±ºã‚ã‚‹ã¨æ¥½ã«ãªã‚‹ã€‚",
        overall:"å²è·¯ã€‚è¿·ã£ãŸã‚‰â€œè»½ããªã‚‹æ–¹â€ã¸ã€‚"
      }},
      { id:23, name:"ãƒã‚ºãƒŸ", icon:"ğŸ­", meanings:{
        love:"ä¸å®‰ãƒ»æ¶ˆè€—ã€‚å°ã•ãªé•å’Œæ„Ÿã¯æ”¾ç½®ã—ãªã„ã€‚",
        work:"ãƒ­ã‚¹ãƒ»æ¼ã‚Œã€‚è¦‹ãˆãªã„å‡ºè²»ã‚’ç‚¹æ¤œã€‚",
        overall:"å‰Šã‚‰ã‚Œã¦ã‚‹æ‰€ã‚’å›å¾©ã€‚ä¼‘ã‚€ã®ã‚‚é–‹é‹ã€‚"
      }},
      { id:24, name:"ãƒãƒ¼ãƒˆ", icon:"â¤ï¸", meanings:{
        love:"æ„›æƒ…ã®æ ¸å¿ƒã€‚ç´ ç›´ãªæƒ³ã„ãŒä¸»å½¹ã€‚",
        work:"æƒ…ç†±ã€‚å¥½ããŒæˆæœã‚’å¼•ãå¯„ã›ã‚‹ã€‚",
        overall:"å–œã³ãŒå¢—ãˆã‚‹ã€‚å¤§äº‹ã«ã—ãŸã„ã‚‚ã®ãŒè¦‹ãˆã‚‹ã€‚"
      }},
      { id:25, name:"æŒ‡è¼ª", icon:"ğŸ’", meanings:{
        love:"ç´„æŸãƒ»çµ†ã€‚é–¢ä¿‚ã®â€œå½¢â€ãŒæ•´ã†å…†ã—ã€‚",
        work:"å¥‘ç´„ãƒ»ç¶™ç¶šã€‚é•·ã„ä»˜ãåˆã„ãŒå§‹ã¾ã‚‹ã€‚",
        overall:"å¾ªç’°ã€‚ç¹°ã‚Šè¿”ã—ã®ä¸­ã§é‹ãŒè‚²ã¤ã€‚"
      }},
      { id:26, name:"æœ¬", icon:"ğŸ“˜", meanings:{
        love:"ç§˜å¯†ãƒ»å­¦ã³ã€‚çŸ¥ã‚‹ã»ã©å„ªã—ããªã‚Œã‚‹ã€‚",
        work:"ç ”ç©¶ãƒ»è³‡æ ¼ã€‚å‹‰å¼·ãŒä»•äº‹é‹ã‚’æŠ¼ã—ä¸Šã’ã‚‹ã€‚",
        overall:"ã¾ã é–‹ã‹ã‚Œã¦ã„ãªã„æ‰‰ã€‚å­¦ã³ãŒéµã€‚"
      }},
      { id:27, name:"æ‰‹ç´™", icon:"âœ‰ï¸", meanings:{
        love:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‚è¨€è‘‰ãŒå¿ƒã‚’ã¤ãªãã€‚",
        work:"æ›¸é¡ãƒ»é€šçŸ¥ã€‚é€£çµ¡ã®è³ªãŒæˆæœã«ç›´çµã€‚",
        overall:"çŸ¥ã‚‰ã›ãŒæ¥ã‚‹ã€‚æ°—ã¥ã„ãŸäººã‹ã‚‰é‹ãŒå‹•ãã€‚"
      }},
      { id:28, name:"ç´³å£«", icon:"ğŸ¤µ", meanings:{
        love:"ç”·æ€§æ€§ãƒ»ä¸»å°ã€‚ç›¸æ‰‹ã®æœ¬éŸ³ãŒå‹•ãã‚„ã™ã„ã€‚",
        work:"ã‚­ãƒ¼ãƒ‘ãƒ¼ã‚½ãƒ³ï¼ˆç”·æ€§/ä¸»ä½“ï¼‰ã€‚ä¸»å½¹ã¯â€œæ±ºã‚ã‚‹äººâ€ã€‚",
        overall:"è¡Œå‹•åŠ›ã®è±¡å¾´ã€‚è‡ªåˆ†ã‹ã‚‰å‹•ãã»ã©è‰¯ã„ã€‚"
      }},
      { id:29, name:"æ·‘å¥³", icon:"ğŸ‘©", meanings:{
        love:"å¥³æ€§æ€§ãƒ»å—å®¹ã€‚é­…åŠ›ãŒè‡ªç„¶ã«ä¼ã‚ã‚‹ã€‚",
        work:"ã‚­ãƒ¼ãƒ‘ãƒ¼ã‚½ãƒ³ï¼ˆå¥³æ€§/æ”¯ãˆã‚‹äººï¼‰ã€‚æ•´ãˆã‚‹åŠ›ãŒè¦ã€‚",
        overall:"å„ªã—ã•ã®è±¡å¾´ã€‚ä¸å¯§ã•ãŒé‹ã‚’ä¸Šã’ã‚‹ã€‚"
      }},
      { id:30, name:"ãƒ¦ãƒª", icon:"ğŸŒ¸", meanings:{
        love:"æˆç†Ÿãƒ»å“ã€‚è½ã¡ç€ã„ãŸæ„›ã€å°Šæ•¬ãŒæ·±ã¾ã‚‹ã€‚",
        work:"å“ä½ãƒ»ä¿¡ç”¨ã€‚èª å®Ÿã•ãŒæ­¦å™¨ã«ãªã‚‹ã€‚",
        overall:"é™ã‹ãªå¹¸ç¦ã€‚æ•´ã£ãŸæš®ã‚‰ã—ãŒãƒ„ã‚­ã‚’å‘¼ã¶ã€‚"
      }},
      { id:31, name:"å¤ªé™½", icon:"â˜€ï¸", meanings:{
        love:"å–œã³ãƒ»æˆåŠŸã€‚ç´ ç›´ã«æ˜ã‚‹ãé€²ã‚ã‚‹æ™‚ã€‚",
        work:"æˆæœãƒ»å‹åˆ©ã€‚è©•ä¾¡ãŒè¦‹ãˆã‚‹å½¢ã«ãªã‚‹ã€‚",
        overall:"é‹æ°—ä¸Šæ˜‡ã€‚å…‰ã®æ–¹ã¸é€²ã‚ã°å¤§ä¸ˆå¤«ã€‚"
      }},
      { id:32, name:"æœˆ", icon:"ğŸŒ™", meanings:{
        love:"ãƒ­ãƒãƒ³ãƒ»æ„Ÿæƒ…ã€‚é›°å›²æ°—ãŒç­”ãˆã‚’æ•™ãˆã‚‹ã€‚",
        work:"è©•åˆ¤ãƒ»æ„Ÿæ€§ã€‚ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãŒå½“ãŸã‚Šã€‚",
        overall:"å¿ƒã®æ³¢ã€‚å¤œã®é™ã‘ã•ã§æ•´ã†é‹ã€‚"
      }},
      { id:33, name:"éµ", icon:"ğŸ—ï¸", meanings:{
        love:"æ ¸å¿ƒãƒ»è§£æ±ºã€‚å¤§äº‹ãªè©±ã‚’ã™ã‚‹ã¨æ‰‰ãŒé–‹ãã€‚",
        work:"çªç ´å£ã€‚ãƒã‚¤ãƒ³ãƒˆã‚’æŠ¼ã•ãˆã‚Œã°å‹ã¦ã‚‹ã€‚",
        overall:"æ­£è§£ãŒè¦‹ã¤ã‹ã‚‹ã€‚è¿·ã„ãŒåæŸã™ã‚‹å…†ã—ã€‚"
      }},
      { id:34, name:"é­š", icon:"ğŸŸ", meanings:{
        love:"è±Šã‹ã•ãƒ»è‡ªç”±ã€‚åŸ·ç€ã‚ˆã‚Šæµã‚ŒãŒæ‹ã‚’è‚²ã¦ã‚‹ã€‚",
        work:"ãŠé‡‘ãƒ»å£²ä¸Šã€‚å¾ªç’°ã‚’å¢—ã‚„ã™ã¨ä¼¸ã³ã‚‹ã€‚",
        overall:"æµã‚Œã«ä¹—ã‚‹é‹ã€‚ã“ã ã‚ã‚Šã‚’ç·©ã‚ã‚‹ã¨å¢—ãˆã‚‹ã€‚"
      }},
      { id:35, name:"éŒ¨", icon:"âš“", meanings:{
        love:"å®‰å®šãƒ»å®šç€ã€‚ã˜ã£ãã‚Šç¶šãé–¢ä¿‚ã¸ã€‚",
        work:"å®‰å®šè·ãƒ»ç¶™ç¶šæ¡ˆä»¶ã€‚è…°ã‚’æ®ãˆã‚‹ã¨æˆæœã€‚",
        overall:"è½ã¡ç€ãé‹ã€‚ãƒ–ãƒ¬ãªã„è»¸ãŒå¹¸é‹ã‚’å›ºå®šã™ã‚‹ã€‚"
      }},
      { id:36, name:"åå­—æ¶", icon:"âœï¸", meanings:{
        love:"å­¦ã³ãƒ»è©¦ç·´ã€‚èƒŒè² ã„ã™ããšåˆ†ã‘åˆã†ã€‚",
        work:"è²¬ä»»ã€‚é‡ã•ã®åˆ†ã ã‘é”æˆæ„ŸãŒã‚ã‚‹ã€‚",
        overall:"æ„å‘³ã®ã‚ã‚‹å‡ºæ¥äº‹ã€‚ä¹—ã‚Šè¶Šãˆã‚‹ã¨å¼·ããªã‚‹ã€‚"
      }},
    ];

    const THEMES = {
      love:   { label:"æ‹æ„›",   tone:"ï¼ˆæ‹ã®ç‰©èªï¼‰" },
      work:   { label:"ä»•äº‹",   tone:"ï¼ˆä»•äº‹ã®ç‰©èªï¼‰" },
      overall:{ label:"å…¨ä½“é‹", tone:"ï¼ˆäººç”Ÿã®ç‰©èªï¼‰" },
    };

    // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’â€œéå»/ç¾åœ¨/æœªæ¥/ã‚¢ãƒ‰ãƒã‚¤ã‚¹â€ã§è‡ªç„¶ã«ã¤ãªããƒ†ãƒ³ãƒ—ãƒ¬
    const STORY = {
      intro: {
        love: "é™ã‹ãªã‚¯ãƒªãƒ¼ãƒ è‰²ã®å…‰ã®ä¸­ã€ã‚ãªãŸã®æ‹ã®ãƒšãƒ¼ã‚¸ãŒã‚ãã‚‰ã‚Œã¾ã™ã€‚",
        work: "ã‚„ã‚ã‚‰ã‹ãªå…‰ã®æœºã®ä¸Šã§ã€ã‚ãªãŸã®ä»•äº‹ã®åœ°å›³ãŒåºƒãŒã£ã¦ã„ãã¾ã™ã€‚",
        overall:"ç©ã‚„ã‹ãªç©ºæ°—ã®ä¸­ã€ã‚ãªãŸã®é‹ã®æµã‚ŒãŒã‚†ã£ãã‚Šå½¢ã«ãªã‚Šã¾ã™ã€‚"
      },
      bridge01: "æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã¯â€œã“ã‚Œã¾ã§â€ã®ä¼ç·šã€‚ã‚ãªãŸãŒç„¡æ„è­˜ã«é¸ã‚“ã§ããŸé“ãŒè¦‹ãˆã¾ã™ã€‚",
      bridge12: "æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã¯â€œã„ã¾â€ã®æ‰‹è§¦ã‚Šã€‚ç¾å®Ÿã®æ¸©åº¦ã‚’ãã®ã¾ã¾æ˜ ã—ã¾ã™ã€‚",
      bridge23: "ãã—ã¦æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ã¯â€œã“ã‚Œã‹ã‚‰â€ã®æ™¯è‰²ã€‚é¸ã³æ–¹æ¬¡ç¬¬ã§è‰²ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚",
      adviceIntro:"æœ€å¾Œã«ã€3æšã®æµã‚Œã‚’æ•´ãˆã‚‹â€œã²ã¨æŠ¼ã—â€ã®ã‚«ãƒ¼ãƒ‰ã‚’å¼•ãã¾ã™ã€‚"
    };

    // =========================
    // ç”»åƒï¼ˆå¤–éƒ¨ãªã—ï¼‰ï¼šSVGã‚’å‹•çš„ç”Ÿæˆ
    // =========================
    function svgDataUrl({name, icon, id}){
      const bg1 = "rgba(255,248,238,1)";
      const bg2 = "rgba(251,244,230,1)";
      const stroke = "rgba(58,47,42,.18)";
      const gold = "rgba(216,168,91,.75)";
      const purple = "rgba(202,163,255,.40)";
      const safeName = escapeXml(name);
      const safeIcon = escapeXml(icon);

      const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="900" height="1200" viewBox="0 0 900 1200">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="${bg1}"/>
      <stop offset="100%" stop-color="${bg2}"/>
    </linearGradient>
    <radialGradient id="r1" cx="20%" cy="20%" r="70%">
      <stop offset="0%" stop-color="${purple}" stop-opacity="1"/>
      <stop offset="60%" stop-color="white" stop-opacity="0"/>
    </radialGradient>
    <radialGradient id="r2" cx="80%" cy="90%" r="70%">
      <stop offset="0%" stop-color="${gold}" stop-opacity="1"/>
      <stop offset="60%" stop-color="white" stop-opacity="0"/>
    </radialGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="16" stdDeviation="18" flood-color="rgba(58,47,42,.18)"/>
    </filter>
  </defs>

  <rect x="60" y="60" width="780" height="1080" rx="56" fill="url(#g)" stroke="${stroke}" stroke-width="6" filter="url(#shadow)"/>
  <rect x="60" y="60" width="780" height="1080" rx="56" fill="url(#r1)"/>
  <rect x="60" y="60" width="780" height="1080" rx="56" fill="url(#r2)"/>

  <circle cx="450" cy="420" r="210" fill="rgba(255,255,255,.62)" stroke="${stroke}" stroke-width="5"/>
  <text x="450" y="470" text-anchor="middle" font-size="170" font-family="system-ui, -apple-system, Segoe UI, Roboto">${safeIcon}</text>

  <text x="450" y="720" text-anchor="middle" font-size="56" font-weight="800"
        font-family="system-ui, -apple-system, Segoe UI, Roboto" fill="rgba(58,47,42,.92)">${safeName}</text>

  <text x="450" y="790" text-anchor="middle" font-size="28" font-weight="700"
        font-family="system-ui, -apple-system, Segoe UI, Roboto" fill="rgba(58,47,42,.65)">No.${id}  Lenormand</text>

  <!-- ãã‚‰ãã‚‰ -->
  <g opacity=".9">
    <path d="M145 190 l12 28 l28 12 l-28 12 l-12 28 l-12-28 l-28-12 l28-12z" fill="rgba(255,255,255,.9)"/>
    <path d="M770 250 l10 22 l22 10 l-22 10 l-10 22 l-10-22 l-22-10 l22-10z" fill="rgba(255,255,255,.85)"/>
    <path d="M720 980 l12 28 l28 12 l-28 12 l-12 28 l-12-28 l-28-12 l28-12z" fill="rgba(255,255,255,.8)"/>
    <path d="M190 1010 l10 22 l22 10 l-22 10 l-10 22 l-10-22 l-22-10 l22-10z" fill="rgba(255,255,255,.75)"/>
  </g>

  <!-- æ ã®é£¾ã‚Š -->
  <rect x="100" y="100" width="700" height="1000" rx="44" fill="none" stroke="rgba(216,168,91,.35)" stroke-width="4"/>
</svg>`.trim();

      return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
    }

    function escapeXml(str){
      return String(str).replace(/[<>&'"]/g, c => ({
        "<":"&lt;","&":"&amp;",">":"&gt;","'":"&apos;",'"':"&quot;"
      }[c]));
    }

    // =========================
    // å ã„ãƒ­ã‚¸ãƒƒã‚¯
    // =========================
    const chips = [...document.querySelectorAll(".chip")];
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");

    const flips = [0,1,2].map(i => document.getElementById("flip"+i));
    const imgs  = [0,1,2].map(i => document.getElementById("img"+i));
    const descs = [0,1,2].map(i => document.getElementById("desc"+i));
    const reveals = [0,1,2].map(i => document.getElementById("reveal"+i));

    const adviceArea = document.getElementById("adviceArea");
    const flipA = document.getElementById("flipA");
    const imgA = document.getElementById("imgA");
    const descA = document.getElementById("descA");
    const revealA = document.getElementById("revealA");
    const summaryText = document.getElementById("summaryText");
    const seedInfo = document.getElementById("seedInfo");

    let mode = "love";
    let drawn = null; // {cards:[..3], advice:..}
    let revealIndex = -1;
    let seed = null;

    chips.forEach(btn=>{
      btn.addEventListener("click", ()=>{
        chips.forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        mode = btn.dataset.mode;
      });
    });

    function mulberry32(a){
      return function(){
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }

    function pickUnique(deck, n, rng){
      const arr = deck.slice();
      // Fisher-Yates
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(rng()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr.slice(0,n);
    }

    function resetUI(){
      drawn = null;
      revealIndex = -1;
      adviceArea.classList.remove("show");
      [0,1,2].forEach(i=>{
        flips[i].classList.remove("revealed");
        imgs[i].removeAttribute("src");
        descs[i].textContent = (i===0)
          ? "ã¾ã ã‚«ãƒ¼ãƒ‰ã¯å¼•ã‹ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"
          : (i===1 ? "éå»ã®ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã„ãŸã‚‰ã€æ¬¡ãŒé–‹ã‘ã¾ã™ã€‚" : "ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã„ãŸã‚‰ã€æ¬¡ãŒé–‹ã‘ã¾ã™ã€‚");
        reveals[i].disabled = true;
      });
      flipA.classList.remove("revealed");
      imgA.removeAttribute("src");
      descA.textContent = "3æšã®çµæœãŒå‡ºãŸã‚‰ã€æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ãŒå¼•ã‘ã¾ã™ã€‚";
      revealA.disabled = true;
      summaryText.textContent = "ã“ã“ã«ã€3æšï¼‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã¤ãªã„ã ç‰©èªã¨åŠ©è¨€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
      seedInfo.textContent = "";
    }

    resetUI();

    startBtn.addEventListener("click", ()=>{
      // æ¯å›é•ã†çµæœã«ï¼šç¾åœ¨æ™‚åˆ»ã§seed
      seed = (Date.now() ^ (Math.random()*1e9)) >>> 0;
      const rng = mulberry32(seed);

      const picks = pickUnique(DECK, 4, rng); // 3æš + advice
      drawn = { cards: picks.slice(0,3), advice: picks[3] };

      // ç”»åƒã‚»ãƒƒãƒˆï¼ˆã¾ã è£ã®ã¾ã¾ï¼‰
      drawn.cards.forEach((c,i)=>{
        imgs[i].src = svgDataUrl(c);
      });
      imgA.src = svgDataUrl(drawn.advice);

      // ãƒœã‚¿ãƒ³è§£æ”¾ï¼šã¾ãšéå»ã ã‘
      revealIndex = 0;
      reveals[0].disabled = false;
      reveals[1].disabled = true;
      reveals[2].disabled = true;

      descs[0].textContent = "ã‚«ãƒ¼ãƒ‰ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚éå»ã‹ã‚‰é–‹ãã¾ã—ã‚‡ã†ã€‚";
      descs[1].textContent = "éå»ã®ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã„ãŸã‚‰ã€æ¬¡ãŒé–‹ã‘ã¾ã™ã€‚";
      descs[2].textContent = "ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã„ãŸã‚‰ã€æ¬¡ãŒé–‹ã‘ã¾ã™ã€‚";

      adviceArea.classList.remove("show");
      flipA.classList.remove("revealed");
      revealA.disabled = true;
      descA.textContent = "3æšã®çµæœãŒå‡ºãŸã‚‰ã€æœ€å¾Œã®ã‚«ãƒ¼ãƒ‰ãŒå¼•ã‘ã¾ã™ã€‚";
      summaryText.textContent = "3æšãŒãã‚ã†ã¨ã€ã¾ã¨ã‚ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
      seedInfo.textContent = `ä»Šå›ã®ã‚·ãƒ£ãƒƒãƒ•ãƒ«ID: ${seed}`;
    });

    resetBtn.addEventListener("click", resetUI);

    function phaseLabel(i){
      return (i===0) ? "éå»" : (i===1 ? "ç¾åœ¨" : "æœªæ¥");
    }

    function cardStoryLine(card, phase, mode){
      const m = card.meanings[mode];
      const opener = {
        "éå»": "ãã‚Œã¯ã€å°‘ã—å‰ã®ã‚ãªãŸã®å ´é¢ã€‚",
        "ç¾åœ¨": "ãã‚Œã¯ã„ã¾ã€ã‚ãªãŸã®ç›®ã®å‰ã«ã‚ã‚‹æ°—é…ã€‚",
        "æœªæ¥": "ãã‚Œã¯ã“ã‚Œã‹ã‚‰ã€é™ã‹ã«è¼ªéƒ­ã‚’æŒã¤å‡ºæ¥äº‹ã€‚"
      }[phase];

      const scent = {
        love: {
          "éå»":"å‡ºä¼šã„æ–¹ãƒ»è·é›¢ã®å–ã‚Šæ–¹ãŒã€ã„ã¾ã®æ„Ÿæƒ…ã®å½¢ã‚’ã¤ãã‚Šã¾ã—ãŸã€‚",
          "ç¾åœ¨":"è¨€è‘‰ã®æ¸©åº¦ã€ç›®ç·šã®ã‚„ã‚ã‚‰ã‹ã•ãŒã€é–¢ä¿‚ã®ç©ºæ°—ã‚’å¤‰ãˆã¦ã„ã¾ã™ã€‚",
          "æœªæ¥":"å°ã•ãªé¸æŠãŒã€ãµãŸã‚Šã®â€œå±…å¿ƒåœ°â€ã‚’æ±ºã‚ã¦ã„ãã¾ã™ã€‚"
        },
        work: {
          "éå»":"ç©ã¿ä¸Šã’ãŸçµŒé¨“ãŒã€ã„ã¾ã®åˆ¤æ–­ã®é€Ÿã•ã«ãªã£ã¦ã„ã¾ã™ã€‚",
          "ç¾åœ¨":"å„ªå…ˆé †ä½ã®ä»˜ã‘æ–¹ãŒã€æˆæœã®å‡ºæ–¹ã‚’å·¦å³ã—ã¦ã„ã¾ã™ã€‚",
          "æœªæ¥":"å‹•ãæ–¹ã²ã¨ã¤ã§ã€è©•ä¾¡ã‚„å½¹å‰²ãŒå¤‰ã‚ã£ã¦ã„ãã¾ã™ã€‚"
        },
        overall: {
          "éå»":"ã“ã‚Œã¾ã§ã®é¸æŠãŒã€ã‚ãªãŸã®é‹ã®æµã‚Œã®å·ç­‹ã«ãªã‚Šã¾ã—ãŸã€‚",
          "ç¾åœ¨":"ã„ã¾ã®æ•´ãˆæ–¹ãŒã€é‹ã®é€šã‚Šé“ã‚’åºƒã’ã¦ã„ã¾ã™ã€‚",
          "æœªæ¥":"ã‚ãªãŸãŒå‘ã‘ã‚‹æ„è­˜ãŒã€æ™¯è‰²ã®æ˜ã‚‹ã•ã‚’å¤‰ãˆã¾ã™ã€‚"
        }
      }[mode][phase];

      return `${phase}ã®ã‚«ãƒ¼ãƒ‰ï¼šã€${card.name}ã€ ${card.icon}\n${opener}\n${m}\n${scent}`;
    }

    function adviceStoryLine(card, mode, threeCards){
      const m = card.meanings[mode];
      const names = threeCards.map(c=>c.name).join(" â†’ ");
      const tone = THEMES[mode].tone;
      const wrap = {
        love:"æ‹ã¯ã€å®‰å¿ƒã¨ã¨ãã‚ãã®ãƒãƒ©ãƒ³ã‚¹ã§è‚²ã¡ã¾ã™ã€‚",
        work:"ä»•äº‹ã¯ã€é¸æŠã¨é›†ä¸­ã§æµã‚ŒãŒæ•´ã„ã¾ã™ã€‚",
        overall:"é‹ã¯ã€æ•´ã£ãŸå ´æ‰€ã«é›†ã¾ã‚Šã‚„ã™ã„ã‚‚ã®ã§ã™ã€‚"
      }[mode];

      return `ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚«ãƒ¼ãƒ‰ï¼šã€${card.name}ã€ ${card.icon} ${tone}\n` +
             `ã“ã“ã¾ã§ã®æµã‚Œï¼ˆ${names}ï¼‰ã‚’ä¸€ã¤ã«æŸã­ã‚‹ãªã‚‰â€•â€•\n` +
             `${m}\n` +
             `${wrap}\n` +
             `â€œä»Šæ—¥ã§ãã‚‹æœ€å°ã®ä¸€æ‰‹â€ã¨ã—ã¦ã€ã“ã®ã‚«ãƒ¼ãƒ‰ã®ç¤ºã™è¡Œå‹•ã‚’é¸ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚`;
    }

    function buildSummary(mode, cards, advice){
      const intro = STORY.intro[mode];
      const a = cardStoryLine(cards[0], "éå»", mode);
      const b = cardStoryLine(cards[1], "ç¾åœ¨", mode);
      const c = cardStoryLine(cards[2], "æœªæ¥", mode);
      const d = adviceStoryLine(advice, mode, cards);

      // 3æšã‚’ç¹‹ãçŸ­ã„ç‰©èªï¼ˆã‚«ãƒ¼ãƒ‰åã ã‘ä½¿ã£ã¦è‡ªç„¶ã«ï¼‰
      const mini = (() => {
        const [p, n, f] = cards.map(x=>x.name);
        const t = THEMES[mode].label;

        return `ã€${t}ã®ç‰©èªã€‘\n` +
          `${p}ãŒç¤ºã™â€œã“ã‚Œã¾ã§â€ã‹ã‚‰å§‹ã¾ã‚Šã€ã„ã¾ã¯${n}ã®æ°—é…ãŒæ¿ƒããªã£ã¦ã„ã¾ã™ã€‚\n` +
          `ãã®æµã‚Œã¯${f}ã¸å‘ã‹ã„ã€ã‚ãªãŸãŒé¸ã¶è¨€è‘‰ãƒ»è¡Œå‹•ã§ã€æ˜ã‚‹ã•ãŒèª¿æ•´ã•ã‚Œã¾ã™ã€‚`;
      })();

      return `${intro}\n\n${STORY.bridge01}\n\n${a}\n\n${STORY.bridge12}\n\n${b}\n\n${STORY.bridge23}\n\n${c}\n\n${STORY.adviceIntro}\n\n${d}\n\n${mini}`;
    }

    function revealCard(i){
      if(!drawn) return;

      const card = drawn.cards[i];
      const phase = phaseLabel(i);

      flips[i].classList.add("revealed");
      descs[i].textContent = cardStoryLine(card, phase, mode);

      // æ¬¡ã‚’é–‹ã‘ã‚‹
      reveals[i].disabled = true;
      if(i < 2){
        reveals[i+1].disabled = false;
      }else{
        // 3æšçµ‚ã‚ã‚Š â†’ ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¸
        adviceArea.classList.add("show");
        revealA.disabled = false;
        descA.textContent = "æº–å‚™ãŒã§ãã¾ã—ãŸã€‚æœ€å¾Œã«ã€èƒŒä¸­ã‚’æŠ¼ã™1æšã‚’é–‹ãã¾ã—ã‚‡ã†ã€‚";
        summaryText.textContent = buildSummary(mode, drawn.cards, drawn.advice);
      }
    }

    reveals.forEach((btn,i)=>{
      btn.addEventListener("click", ()=>{
        // é †ç•ªã‚¬ãƒ¼ãƒ‰
        if(i===0 || (i===1 && flips[0].classList.contains("revealed")) || (i===2 && flips[1].classList.contains("revealed"))){
          revealCard(i);
        }
      });
    });

    revealA.addEventListener("click", ()=>{
      if(!drawn) return;
      flipA.classList.add("revealed");
      descA.textContent = adviceStoryLine(drawn.advice, mode, drawn.cards);
      revealA.disabled = true;

      // ã¾ã¨ã‚ã‚’æ›´æ–°ï¼ˆã‚¢ãƒ‰ãƒã‚¤ã‚¹é–‹ã„ãŸå¾Œã®ç· ã‚ï¼‰
      const outro = {
        love:"æœ€å¾Œã«æ·±å‘¼å¸ã€‚ã‚ãªãŸã®æ‹ã¯ã€ã‚ãªãŸã®å„ªã—ã•ã§é€²ã‚ã‚‰ã‚Œã¾ã™ã€‚",
        work:"æœ€å¾Œã«ä¸€ã¤ã ã‘ã€‚æ˜æ—¥ã®æœ€åˆã®15åˆ†ã‚’ã€ã‚«ãƒ¼ãƒ‰ã®ç¤ºã™è¡Œå‹•ã«ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ã€‚",
        overall:"æœ€å¾Œã«æ•´ãˆã‚‹ã€‚å°ã•ãªç‰‡ã¥ã‘ãƒ»å°ã•ãªç´„æŸãŒã€é‹ã®å…¥å£ã«ãªã‚Šã¾ã™ã€‚"
      }[mode];

      summaryText.textContent = buildSummary(mode, drawn.cards, drawn.advice) + `\n\nã€ã²ã¨ã“ã¨ã€‘\n${outro}`;
    });
  </script>
</body>
</html>
